<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page.title">PhonePe Money Transfer Tutorial - Teach your parents smartphone</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        .clickable-area {
            position: absolute;
            background-color: rgba(95, 37, 159, 0);
            /* Transparent initially */
            border: 2px solid rgba(95, 37, 159, 0);
            /* Transparent initially */
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .debug-mode .clickable-area {
            background-color: rgba(95, 37, 159, 0.2);
            border: 2px dashed #5f259f;
        }

        #to-mobile-button {
            top: 31%;
            /* Approximately 199px / 640px */
            width: 39%;
            /* Approximately 126px / 320px */
            height: 15.6%;
            /* Approximately 100px / 640px */
        }

        #back-to-home {
            left: 1.5%;
            top: 1.5%;
            width: 12.5%;
            height: 6.25%;
        }

        #new-payment {
            left: 56%;
            top: 89%;
            width: 43%;
            height: 9.4%;
        }

        #back-to-sendmoney {
            left: 1.5%;
            top: 1.5%;
            width: 12.5%;
            height: 6.25%;
        }

        #search-contact {
            left: 1.5%;
            top: 7.8%;
            width: 97%;
            height: 9.4%;
        }

        #tap-to-select {
            left: 1.5%;
            top: 12.6%;
            width: 97%;
            height: 9.4%;
        }

        #searchcontact-button {
            left: 1.5%;
            top: 1.5%;
            width: 12.5%;
            height: 6.25%;
        }

        #pay {
            left: 78%;
            top: 60%;
            width: 20%;
            height: 9.4%;
        }

        .feedback {
            position: absolute;
            background-color: var(--success);
            color: white;
            padding: 5%;
            border-radius: 10px;
            font-size: 16px;
            width: 70%;
            left: 15%;
            /* Center horizontally */
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #home-feedback {
            top: 50%;
        }

        #sendmoney-feedback {
            top: 50%;
        }

        #selectcontact-feedback {
            top: 50%;
        }

        #searchcontact-feedback {
            top: 50%;
        }

        #pay-feedback {
            top: 50%;
        }

        .step-instructions {
            background-color: #f8f0ff;
            border-left: 5px solid #5f259f;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            max-width: 600px;
            width: 100%;
            font-size: 16px;
            line-height: 1.5;
        }

        .step-instructions strong {
            color: #5f259f;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 data-i18n="tutorial.title">Sending Money on PhonePe</h1>

        <!-- Step instructions section -->
        <div class="step-instructions" id="step-instructions" data-i18n="step1.instruction">
            <strong>Step 1:</strong> This is the PhonePe home screen. To send money to someone, tap on the "To mobile
            number" option under Money Transfers. This lets you send money to any phone number in India.
        </div>

        <div class="progress-indicator">
            <div class="progress-dot active" data-step="1"></div>
            <div class="progress-dot" data-step="2"></div>
            <div class="progress-dot" data-step="3"></div>
            <div class="progress-dot" data-step="4"></div>
            <div class="progress-dot" data-step="5"></div>
        </div>

        <div class="phone-container" id="phone-container">
            <!-- Home Screen -->
            <div class="screen" id="home-screen">
                <!-- Home screen image -->
                <img src="../images/send-money-phonepe/home.png" alt="PhonePe Home Screen"
                    class="screenshot language-image" data-img-base="../images/send-money-phonepe/home">

                <!-- Define clickable areas for home screen (now using responsive percentages) -->
                <div class="clickable-area" id="to-mobile-button" data-next-screen="sendmoney-screen">
                </div>

                <div class="feedback" id="home-feedback" data-i18n="feedback.home">
                    Good job! Now you'll see the Send Money screen.
                </div>
            </div>

            <!-- Send Money Screen -->
            <div class="screen hidden" id="sendmoney-screen">
                <!-- Send money screen image -->
                <img src="../images/send-money-phonepe/send-money.png" alt="PhonePe Send Money Screen"
                    class="screenshot language-image" data-img-base="../images/send-money-phonepe/send-money">

                <!-- Define clickable areas for send money screen -->
                <div class="clickable-area" id="back-to-home" data-next-screen="home-screen">
                </div>

                <div class="clickable-area" id="new-payment" data-next-screen="selectcontact-screen">
                </div>

                <div class="feedback" id="sendmoney-feedback" data-i18n="feedback.sendmoney">
                    Perfect! You've selected New Payment. Now you'll see contact numbers.
                </div>
            </div>

            <!-- Select Contact Screen -->
            <div class="screen hidden" id="selectcontact-screen">
                <img src="../images/send-money-phonepe/select-contact.png" alt="PhonePe Select Contact Screen"
                    class="screenshot language-image" data-img-base="../images/send-money-phonepe/select-contact">

                <div class="clickable-area" id="back-to-sendmoney" data-next-screen="sendmoney-screen">
                </div>

                <div class="clickable-area" id="search-contact" data-next-screen="searchcontact-screen">
                </div>

                <div class="feedback" id="selectcontact-feedback" data-i18n="feedback.selectcontact">
                    Great! You've selected to enter the contact number.
                </div>
            </div>

            <!-- Search Contact Screen -->
            <div class="screen hidden" id="searchcontact-screen">
                <img src="../images/send-money-phonepe/search-contact.png" alt="PhonePe Search Contact Screen"
                    class="screenshot language-image" data-img-base="../images/send-money-phonepe/search-contact">

                <div class="clickable-area" id="selectcontact-screen" data-next-screen="sendmoney-screen">
                </div>

                <div class="clickable-area" id="tap-to-select" data-next-screen="pay-screen">
                </div>

                <div class="feedback" id="searchcontact-feedback" data-i18n="feedback.searchcontact">
                    Great! You've selected the contact number to make a new payment.
                </div>
            </div>

            <!-- Pay Screen -->
            <div class="screen hidden" id="pay-screen">
                <img src="../images/send-money-phonepe/pay.png" alt="PhonePe Pay Screen"
                    class="screenshot language-image" data-img-base="../images/send-money-phonepe/pay">

                <div class="clickable-area" id="searchcontact-button" data-next-screen="searchcontact-screen">
                </div>

                <div class="clickable-area" id="pay" data-next-screen="completion-screen">
                </div>

                <div class="feedback" id="pay-feedback" data-i18n="feedback.pay">
                    Awesome! Post this, just enter UPI PIN to complete the payment.
                </div>
            </div>

            <!-- Completion Screen (success message) -->
            <div class="screen hidden" id="completion-screen">
                <div
                    style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #f5f5f5;">
                    <div
                        style="width: 100px; height: 100px; background-color: #4CAF50; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
                        <span style="color: white; font-size: 50px;">✓</span>
                    </div>
                    <h2 style="color: #5f259f; margin-bottom: 10px;" data-i18n="completion.success">Payment Successful!
                    </h2>
                    <p style="font-size: 18px; color: #666; margin-bottom: 30px;" data-i18n="completion.message">₹1 sent
                        to Ashish</p>
                    <button id="reset-button" data-i18n="button.back">Back to Home</button>
                </div>
            </div>
        </div>

        <div class="task-complete" id="task-complete">
            <span data-i18n="tutorial.completion">Congratulations! You've successfully learned how to send money to a
                mobile number using PhonePe.</span>
            <br><br>
            <button onclick="window.location.href='/'" class="primary-button" data-i18n="button.back">Back to
                Home</button>
        </div>

        <div class="tutorial-controls">
            <button id="prev-button" disabled data-i18n="button.previous">Previous Step</button>
            <button id="hint-button" data-i18n="button.hint">Show Hint</button>
            <button id="reset-button" data-i18n="button.reset">Start Over</button>
            <button id="debug-toggle" data-i18n="button.debug">Show Clickable Areas</button>
        </div>

        <a href="/" class="back-link">← <span data-i18n="button.back">Back to Home</span></a>
    </div>

    <!-- Load the localization script -->
    <script src="../js/localization.js"></script>

    <script>
        // Tutorial state
        const tutorial = {
            currentScreen: 'home-screen',
            currentStep: 1,
            totalSteps: 5,
            expectedActions: {
                'home-screen': 'to-mobile-button',
                'sendmoney-screen': 'new-payment',
                'selectcontact-screen': 'search-contact',
                'searchcontact-screen': 'tap-to-select',
                'pay-screen': 'pay',
                'amount-screen': 'send-again-button'
            },
            instructions: {
                // Instructions will be loaded from translation files
            }
        };

        // Get DOM elements
        const phoneContainer = document.getElementById('phone-container');
        const instructionsElement = document.getElementById('step-instructions');
        const prevButton = document.getElementById('prev-button');
        const hintButton = document.getElementById('hint-button');
        const resetButton = document.getElementById('reset-button');
        const debugToggle = document.getElementById('debug-toggle');
        const taskComplete = document.getElementById('task-complete');

        // Set up event listeners for clickable areas
        document.querySelectorAll('.clickable-area').forEach(area => {
            area.addEventListener('click', handleAreaClick);
        });

        // Set up tutorial control buttons
        prevButton.addEventListener('click', goToPreviousStep);
        hintButton.addEventListener('click', showHint);
        resetButton.addEventListener('click', resetTutorial);
        debugToggle.addEventListener('click', toggleDebugMode);

        function updateInstructions() {
            // Get translation key for current step
            const key = `step${tutorial.currentStep}.instruction`;

            // Get translated instruction from the i18n system
            const translations = window.localization?.getTranslations() || {};
            const translatedInstruction = translations[key];

            if (translatedInstruction) {
                instructionsElement.innerHTML = translatedInstruction;
            } else {
                // Fallback - get the data-i18n attribute's original content
                instructionsElement.setAttribute('data-i18n', key);
            }
        }

        // Update the progress indicator
        function updateProgress() {
            document.querySelectorAll('.progress-dot').forEach(dot => {
                const step = parseInt(dot.dataset.step);
                if (step === tutorial.currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Handle clicking on interactive areas
        function handleAreaClick(e) {
            const clickedId = e.target.id;
            const currentScreen = tutorial.currentScreen;
            const expectedAction = tutorial.expectedActions[currentScreen];

            if (clickedId === expectedAction) {
                // Show success feedback
                const feedbackId = `${currentScreen.split('-')[0]}-feedback`;
                const feedback = document.getElementById(feedbackId);
                if (feedback) {
                    feedback.style.opacity = '1';

                    // Wait a moment, then proceed to next screen
                    setTimeout(() => {
                        const nextScreen = e.target.dataset.nextScreen;
                        if (nextScreen) {
                            transitionToScreen(nextScreen);

                            // Update step
                            if (tutorial.currentStep < tutorial.totalSteps) {
                                tutorial.currentStep++;
                                updateProgress();
                                updateInstructions();
                                updateButtonStates();
                            }
                        }
                    }, 1500);
                }
            } else {
                // If it's a back button, allow navigation
                if (clickedId.includes('back-') && e.target.dataset.nextScreen) {
                    transitionToScreen(e.target.dataset.nextScreen);
                    tutorial.currentStep--;
                    updateProgress();
                    updateInstructions();
                    updateButtonStates();
                } else {
                    // Wrong action - provide hint
                    showHint();
                }
            }
        }

        // Transition to a different screen
        function transitionToScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });

            // Hide all feedback messages
            document.querySelectorAll('.feedback').forEach(feedback => {
                feedback.style.opacity = '0';
            });

            // Show the target screen
            document.getElementById(screenId).classList.remove('hidden');

            // Update current screen in tutorial state
            tutorial.currentScreen = screenId;

            // Remove any highlights
            document.querySelectorAll('.highlight').forEach(element => {
                element.classList.remove('highlight');
            });

            // Show task complete message if reached the final screen
            if (screenId === 'completion-screen') {
                setTimeout(() => {
                    taskComplete.style.display = 'block';
                }, 1500);
            } else {
                taskComplete.style.display = 'none';
            }
        }

        // Go to the previous step
        function goToPreviousStep() {
            if (tutorial.currentStep > 1) {
                tutorial.currentStep--;

                // Determine which screen to show based on the step
                let targetScreen;
                if (tutorial.currentStep === 1) {
                    targetScreen = 'home-screen';
                } else if (tutorial.currentStep === 2) {
                    targetScreen = 'sendmoney-screen';
                } else if (tutorial.currentStep === 3) {
                    targetScreen = 'selectcontact-screen';
                } else if (tutorial.currentStep === 4) {
                    targetScreen = 'searchcontact-screen';
                }

                transitionToScreen(targetScreen);
                updateProgress();
                updateInstructions();
                updateButtonStates();
            }
        }

        // Show hint by highlighting the correct element
        function showHint() {
            const currentScreen = tutorial.currentScreen;
            const expectedAction = tutorial.expectedActions[currentScreen];

            // Remove any existing highlights
            document.querySelectorAll('.highlight').forEach(element => {
                element.classList.remove('highlight');
            });

            // Add highlight to the expected action
            const elementToHighlight = document.getElementById(expectedAction);
            if (elementToHighlight) {
                elementToHighlight.classList.add('highlight');

                // Get translated instruction with HINT prefix
                const key = `step${tutorial.currentStep}.instruction`;
                const translations = window.localization?.getTranslations() || {};
                const translatedInstruction = translations[key];

                if (translatedInstruction) {
                    instructionsElement.innerHTML = "<strong>HINT:</strong> " + translatedInstruction.replace(/<strong>.*?<\/strong>/, '');
                } else {
                    // Fallback
                    instructionsElement.innerHTML = "<strong>HINT:</strong> " + instructionsElement.innerHTML.replace(/<strong>.*?<\/strong>/, '');
                }
            }
        }

        // Reset the tutorial to the beginning
        function resetTutorial() {
            tutorial.currentScreen = 'home-screen';
            tutorial.currentStep = 1;

            transitionToScreen('home-screen');
            updateProgress();
            updateInstructions();
            updateButtonStates();

            taskComplete.style.display = 'none';
        }

        // Toggle debug mode to show/hide clickable areas
        function toggleDebugMode() {
            phoneContainer.classList.toggle('debug-mode');
            if (phoneContainer.classList.contains('debug-mode')) {
                debugToggle.textContent = window.localization?.getTranslations()?.['button.hideDebug'] || 'Hide Clickable Areas';
            } else {
                debugToggle.textContent = window.localization?.getTranslations()?.['button.debug'] || 'Show Clickable Areas';
            }
        }

        // Update the state of the navigation buttons
        function updateButtonStates() {
            prevButton.disabled = tutorial.currentStep === 1;
        }

        // Load tutorial instructions based on selected language
        function loadTutorialInstructions() {
            // Automatically handled by the localization.js script
            // which will translate all elements with data-i18n attributes

            // Set instructions for each step
            for (let i = 1; i <= tutorial.totalSteps; i++) {
                const key = `step${i}.instruction`;
                tutorial.instructions[i] = window.localization?.getTranslations()?.[key] ||
                    document.querySelector(`[data-i18n="${key}"]`)?.innerHTML || '';
            }

            // Update current instruction
            updateInstructions();
        }

        // Initialize the tutorial
        function initTutorial() {
            updateProgress();

            // Check if localization script is loaded
            if (window.localization) {
                // Add callback for language changes
                const originalChangeLanguage = window.localization.changeLanguage;
                window.localization.changeLanguage = function (lang) {
                    originalChangeLanguage(lang);
                    // After language change, update tutorial content
                    loadTutorialInstructions();
                };

                // Initialize translations
                window.localization.getTranslations = function () {
                    return window.translationCache?.[`${window.localization.getCurrentLanguage()}_phonepe`] || {};
                };
            }

            loadTutorialInstructions();
            updateButtonStates();
        }

        // Start the tutorial when the page loads
        window.onload = initTutorial;
    </script>
</body>

</html>